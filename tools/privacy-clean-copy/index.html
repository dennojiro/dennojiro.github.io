<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Privacy Clean Copy</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #1c2230;
      --muted: #5f6b84;
      --border: #dfe4ef;
      --accent: #315efb;
      --ok: #067647;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.45;
    }
    .wrap {
      max-width: 980px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px rgba(17, 24, 39, 0.05);
    }
    h1 { margin: 0 0 .4rem; font-size: 1.5rem; }
    p { margin: .2rem 0; color: var(--muted); }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }
    textarea {
      width: 100%;
      min-height: 280px;
      padding: .8rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      font: 14px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      resize: vertical;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: .6rem;
      margin-top: .8rem;
    }
    button {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      padding: .55rem .85rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary {
      border-color: var(--accent);
      background: var(--accent);
      color: white;
    }
    button:disabled {
      opacity: .55;
      cursor: not-allowed;
    }
    .stats {
      font-size: .95rem;
      color: var(--muted);
      margin-top: .7rem;
      border-top: 1px solid var(--border);
      padding-top: .7rem;
    }
    .stats strong { color: var(--ok); }
    .preview-toggle {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      margin-top: .8rem;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
    }
    .preview-toggle input { margin: 0; }
    .preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .8rem;
      margin-top: .8rem;
    }
    @media (max-width: 820px) { .preview-grid { grid-template-columns: 1fr; } }
    .preview-col h4 {
      margin: 0 0 .45rem;
      font-size: .95rem;
      color: var(--muted);
    }
    .preview-box {
      margin: 0;
      min-height: 180px;
      max-height: 340px;
      overflow: auto;
      padding: .75rem;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fbfcff;
      font: 13px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .hidden { display: none; }
    code { background: #eef2ff; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Privacy Clean Copy</h1>
      <p>Paste text, click <strong>Scrub</strong>, and share the cleaned version. Runs entirely in your browser.</p>
      <p>Targets common identifiers: email, phone, credit card-like numbers, IBAN, and IP addresses.</p>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Original text</h3>
        <textarea id="input" placeholder="Paste message, notes, logs, or customer support text here..."></textarea>
        <div class="actions">
          <button class="primary" id="scrubBtn">Scrub</button>
          <button id="clearBtn">Clear</button>
          <button id="demoBtn">Insert demo</button>
        </div>
      </div>

      <div class="card">
        <h3>Safe-to-share copy</h3>
        <textarea id="output" readonly placeholder="Cleaned text appears here"></textarea>
        <div class="actions">
          <button id="copyBtn">Copy cleaned text</button>
          <button id="undoBtn" title="Revert the latest scrub result" disabled>Undo last scrub</button>
        </div>

        <label class="preview-toggle" for="previewToggle">
          <input type="checkbox" id="previewToggle" />
          Show before/after preview
        </label>

        <div class="preview-grid hidden" id="previewGrid" aria-live="polite">
          <div class="preview-col">
            <h4>Before (original)</h4>
            <pre class="preview-box" id="beforePreview">No input yet.</pre>
          </div>
          <div class="preview-col">
            <h4>After (cleaned)</h4>
            <pre class="preview-box" id="afterPreview">Run Scrub to preview redactions.</pre>
          </div>
        </div>

        <div class="stats" id="stats">No scan yet.</div>
      </div>
    </div>

    <div class="card">
      <p><strong>Tip:</strong> Placeholders look like <code>[REDACTED_EMAIL]</code> so teammates know context without seeing raw data.</p>
    </div>
  </div>

  <script>
    const patterns = [
      { name: 'email', label: '[REDACTED_EMAIL]', re: /\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b/g },
      { name: 'phone', label: '[REDACTED_PHONE]', re: /(?<!\w)(?:\+?\d{1,3}[\s.-]?)?(?:\(?\d{2,4}\)?[\s.-]?)\d{2,4}[\s.-]?\d{2,4}(?:[\s.-]?\d{2,4})?(?!\w)/g },
      { name: 'creditCard', label: '[REDACTED_CARD]', re: /\b(?:\d[ -]*?){13,19}\b/g },
      { name: 'iban', label: '[REDACTED_IBAN]', re: /\b[A-Z]{2}\d{2}[A-Z0-9]{11,30}\b/g },
      { name: 'ip', label: '[REDACTED_IP]', re: /\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\b/g }
    ];

    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const stats = document.getElementById('stats');
    const undoBtn = document.getElementById('undoBtn');
    const previewToggle = document.getElementById('previewToggle');
    const previewGrid = document.getElementById('previewGrid');
    const beforePreview = document.getElementById('beforePreview');
    const afterPreview = document.getElementById('afterPreview');

    let lastScrubSnapshot = null;

    function scrub(text) {
      const counts = { email: 0, phone: 0, creditCard: 0, iban: 0, ip: 0 };
      let cleaned = text;

      for (const p of patterns) {
        cleaned = cleaned.replace(p.re, (match) => {
          if (p.name === 'creditCard') {
            const digits = match.replace(/\D/g, '');
            if (digits.length < 13 || digits.length > 19) return match;
          }
          counts[p.name]++;
          return p.label;
        });
      }

      return { cleaned, counts };
    }

    function renderCounts(counts) {
      const total = Object.values(counts).reduce((a, b) => a + b, 0);
      stats.innerHTML = total
        ? `<strong>${total}</strong> item(s) redacted Â· ` +
          `Email: ${counts.email}, Phone: ${counts.phone}, Card: ${counts.creditCard}, IBAN: ${counts.iban}, IP: ${counts.ip}`
        : 'No obvious sensitive data found.';
    }

    function setUndoEnabled(enabled) {
      undoBtn.disabled = !enabled;
    }

    function rememberCurrentOutputState() {
      if (!output.value && stats.textContent === 'No scan yet.') {
        lastScrubSnapshot = null;
        setUndoEnabled(false);
        return;
      }
      lastScrubSnapshot = {
        output: output.value,
        statsHtml: stats.innerHTML,
        statsText: stats.textContent
      };
      setUndoEnabled(true);
    }

    function refreshPreview() {
      beforePreview.textContent = input.value || 'No input yet.';
      afterPreview.textContent = output.value || 'Run Scrub to preview redactions.';
    }

    document.getElementById('scrubBtn').addEventListener('click', () => {
      rememberCurrentOutputState();
      const { cleaned, counts } = scrub(input.value || '');
      output.value = cleaned;
      renderCounts(counts);
      refreshPreview();
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      if (!output.value) return;
      try {
        await navigator.clipboard.writeText(output.value);
        stats.textContent = 'Copied cleaned text to clipboard.';
      } catch {
        stats.textContent = 'Copy failed. Select and copy manually.';
      }
    });

    undoBtn.addEventListener('click', () => {
      if (!lastScrubSnapshot) return;
      output.value = lastScrubSnapshot.output;
      if (lastScrubSnapshot.statsHtml) {
        stats.innerHTML = lastScrubSnapshot.statsHtml;
      } else {
        stats.textContent = lastScrubSnapshot.statsText || 'No scan yet.';
      }
      lastScrubSnapshot = null;
      setUndoEnabled(false);
      refreshPreview();
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      input.value = '';
      output.value = '';
      stats.textContent = 'Cleared.';
      lastScrubSnapshot = null;
      setUndoEnabled(false);
      refreshPreview();
    });

    document.getElementById('demoBtn').addEventListener('click', () => {
      input.value = `Hi support team,\n\nMy name is Sam. My email is sam.lee@example.com and my backup is sam+work@company.co.uk.\nCall me at +49 171 234 5678.\nOur server 192.168.1.44 keeps failing.\nPayment card used: 4111 1111 1111 1111\nRefund IBAN: DE89370400440532013000\n\nThanks.`;
      stats.textContent = 'Demo inserted. Click Scrub.';
      refreshPreview();
    });

    previewToggle.addEventListener('change', () => {
      previewGrid.classList.toggle('hidden', !previewToggle.checked);
      if (previewToggle.checked) refreshPreview();
    });

    input.addEventListener('input', () => {
      if (previewToggle.checked) refreshPreview();
    });

    refreshPreview();
  </script>
</body>
</html>
