<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Proof Badge Pack Generator</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial,sans-serif;max-width:900px;margin:24px auto;padding:0 16px;background:#f7f7f8;color:#111}
    textarea{width:100%;min-height:220px;font-family:ui-monospace,monospace}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    button{padding:10px 14px;border:1px solid #ccc;border-radius:10px;background:#fff;cursor:pointer}
    .ok{color:#1f9d55;font-weight:600}.err{color:#d64545;font-weight:600}
    .card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:12px;margin-top:12px}
    code{background:#eee;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Proof Badge Pack Generator (Local)</h1>
  <p>Paste a <code>proof_bundle</code> JSON, generate square/story/banner SVG files + manifest in your browser.</p>

  <textarea id="input"></textarea>
  <div class="row">
    <button id="sample">Load sample</button>
    <button id="gen">Generate badge pack</button>
    <button id="dlManifest" disabled>Download manifest.json</button>
    <button id="dlSquare" disabled>Download square.svg</button>
    <button id="dlStory" disabled>Download story.svg</button>
    <button id="dlBanner" disabled>Download banner.svg</button>
  </div>
  <div id="status"></div>
  <div id="meta" class="card" hidden></div>

<script>
const sample = {
  version:'v0',
  claim:{hash:'b9d2f1e37fd2f9882ce1b5a41f4662a5ec23f201f3ac8747a2f9b8148a8f15dc',algo:'sha256',createdAt:new Date().toISOString()},
  signature:{keyId:'did:key:z6Mkf6f7F3Qn9j5K2w9sA3r1',sig:'5fdace001122334455',sigAlgo:'ed25519'},
  verification:{status:'verified',verifiedAt:new Date().toISOString(),verifier:'denno-verify-v0'}
};
const state = { files: null, manifest: null };

function shortHex(h,left=10,right=8){ if(!h) return ''; return h.length<=left+right+1?h:`${h.slice(0,left)}…${h.slice(-right)}`; }
function esc(s=''){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }
function stickerSvg({w,h,status,color,claim,signer,verifier,title}){
  const pad=Math.round(w*0.06), headerH=Math.round(h*0.22), labelSize=Math.max(16,Math.round(w*0.035)), valueSize=Math.max(16,Math.round(w*0.038));
  return `<?xml version="1.0" encoding="UTF-8"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">\n  <rect x="2" y="2" width="${w-4}" height="${h-4}" rx="${Math.round(w*0.03)}" fill="#ffffff" stroke="#dddddd"/>\n  <rect x="2" y="2" width="${w-4}" height="${headerH}" rx="${Math.round(w*0.03)}" fill="${color}"/>\n  <text x="${pad}" y="${Math.round(headerH*0.62)}" fill="#ffffff" font-size="${Math.max(18,Math.round(w*0.045))}" font-family="Inter,Segoe UI,Arial,sans-serif" font-weight="700">${esc(title)} · ${esc(status.toUpperCase())}</text>\n  <text x="${pad}" y="${Math.round(h*0.42)}" fill="#6b7280" font-size="${labelSize}" font-family="Inter,Segoe UI,Arial,sans-serif">Claim</text>\n  <text x="${Math.round(w*0.28)}" y="${Math.round(h*0.42)}" fill="#111827" font-size="${valueSize}" font-family="ui-monospace,SFMono-Regular,Menlo,monospace">${esc(claim)}</text>\n  <text x="${pad}" y="${Math.round(h*0.60)}" fill="#6b7280" font-size="${labelSize}" font-family="Inter,Segoe UI,Arial,sans-serif">Signer</text>\n  <text x="${Math.round(w*0.28)}" y="${Math.round(h*0.60)}" fill="#111827" font-size="${valueSize}" font-family="ui-monospace,SFMono-Regular,Menlo,monospace">${esc(signer)}</text>\n  <text x="${pad}" y="${Math.round(h*0.78)}" fill="#6b7280" font-size="${labelSize}" font-family="Inter,Segoe UI,Arial,sans-serif">Verifier</text>\n  <text x="${Math.round(w*0.28)}" y="${Math.round(h*0.78)}" fill="#111827" font-size="${valueSize}" font-family="ui-monospace,SFMono-Regular,Menlo,monospace">${esc(verifier)}</text>\n</svg>`;
}
function download(name, text, mime='text/plain'){ const blob=new Blob([text],{type:mime}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),500); }
function setStatus(msg,ok=true){ const el=document.getElementById('status'); el.className=ok?'ok':'err'; el.textContent=msg; }

function generate(){
  try {
    const b = JSON.parse(document.getElementById('input').value);
    const status=(b?.verification?.status||'pending').toLowerCase();
    const color=status==='verified'?'#1f9d55':status==='failed'?'#d64545':'#9a7d0a';
    const claim=shortHex(b?.claim?.hash||'unknown');
    const signer=shortHex(b?.signature?.keyId||'unknown',12,8);
    const verifier=b?.verification?.verifier||'n/a';
    state.files = {
      'square.svg': stickerSvg({w:1080,h:1080,status,color,claim,signer,verifier,title:'Proof Sticker'}),
      'story.svg': stickerSvg({w:1080,h:1920,status,color,claim,signer,verifier,title:'Proof Sticker'}),
      'banner.svg': stickerSvg({w:1500,h:500,status,color,claim,signer,verifier,title:'Proof Sticker'})
    };
    state.manifest = {
      version:'v0',
      generatedAt:new Date().toISOString(),
      count:3,
      files:Object.keys(state.files).sort().map(f=>({file:f,bytes:new Blob([state.files[f]]).size}))
    };
    document.getElementById('dlManifest').disabled=false;
    document.getElementById('dlSquare').disabled=false;
    document.getElementById('dlStory').disabled=false;
    document.getElementById('dlBanner').disabled=false;
    document.getElementById('meta').hidden=false;
    document.getElementById('meta').innerHTML = `<b>Generated:</b> ${state.manifest.generatedAt}<br><b>Status:</b> ${status.toUpperCase()}<br><b>Files:</b> ${state.manifest.files.map(f=>`${f.file} (${f.bytes} bytes)`).join(', ')}`;
    setStatus('Badge pack generated locally. Use the download buttons.', true);
  } catch (e) {
    setStatus(`Invalid JSON: ${e.message}`, false);
  }
}

document.getElementById('input').value = JSON.stringify(sample,null,2);
document.getElementById('sample').onclick = ()=>{ document.getElementById('input').value = JSON.stringify(sample,null,2); setStatus('Sample loaded.', true); };
document.getElementById('gen').onclick = generate;
document.getElementById('dlManifest').onclick = ()=>download('manifest.json', JSON.stringify(state.manifest,null,2)+'\n', 'application/json');
document.getElementById('dlSquare').onclick = ()=>download('square.svg', state.files['square.svg'], 'image/svg+xml');
document.getElementById('dlStory').onclick = ()=>download('story.svg', state.files['story.svg'], 'image/svg+xml');
document.getElementById('dlBanner').onclick = ()=>download('banner.svg', state.files['banner.svg'], 'image/svg+xml');
</script>
</body>
</html>
